(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,a){},15:function(e,t,a){},16:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(2),i=a.n(o),s=(a(14),a(15),a(3)),l=a(4),c=a(6),y=a(5),u=a(7),d=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(y.a)(t).call(this,e))).tileSize=10,a.money=100,a.currentSteps=0,a.generationSteps=100,a.size=50,a.scale=1,a.centerX=a.size/2,a.centerY=a.size/2,a.canvasSize=800,a.canvas=null,a.ctx=null,a.allTiles=[],a.newTiles=[],a.gridTiles={},a.allUnits=[],a.getTile=function(e,t,n){var r=a.gridTiles[e+","+t];return!r&&n&&(r={x:e,y:t,type:"empty"},a.setTile(e,t,r)),r},a.setTile=function(e,t,n){a.gridTiles[e+","+t]||a.newTiles.push(n),a.gridTiles[e+","+t]=n},a.drawTile=function(e,t){switch(e.type){case"yourbusiness":t.fillStyle="purple";break;case"water":t.fillStyle="blue";break;case"nature":t.fillStyle="darkgreen";break;case"road":t.fillStyle="grey";break;case"busyroad":t.fillStyle="#555";break;case"house":t.fillStyle="brown";break;case"apartment":t.fillStyle="red";break;case"smallbusiness":t.fillStyle="orange";break;case"shoppingcenter":t.fillStyle="yellow";break;case"downtown":t.fillStyle="lightgrey";break;default:t.fillStyle="green"}var n=a.tileSize*a.scale,r=(e.x-a.centerX)*n+a.canvasSize/2,o=(e.y-a.centerY)*n+a.canvasSize/2;t.fillRect(Math.floor(r),Math.floor(o),Math.ceil(n),Math.ceil(n))},a.seedWater=function(){for(var e=-.5*a.size;e<1.5*a.size;e++)for(var t=-.5*a.size;t<1.5*a.size;t++)Math.random()<.002&&(a.setTile(e,t,{x:e,y:t,type:"water"}),a.getNeighbors(e,t,!0));a.addNewTiles();for(var n=0;n<5;n++)a.allTiles.forEach(function(e){if("empty"==e.type){var t=a.getNeighbors(e.x,e.y,!0),n=a.getTypes(t);n.water>2?Math.random()<.33&&(e.type="water"):n.water>1?Math.random()<.25&&(e.type="water"):Math.random()<.05&&(e.type="water")}}),a.addNewTiles()},a.seedNature=function(){for(var e=0;e<a.size;e++)for(var t=0;t<a.size;t++)a.getTile(e,t,!1)||Math.random()<.005&&(a.setTile(e,t,{x:e,y:t,type:"nature"}),a.getNeighbors(e,t,!0));a.addNewTiles();for(var n=0;n<7;n++)a.allTiles.forEach(function(e){if("empty"==e.type){var t=a.getNeighbors(e.x,e.y,!0),n=a.getTypes(t);n.water>2||n.nature>2?Math.random()<.33&&(e.type="nature"):Math.random()<.05&&(e.type="nature")}}),a.addNewTiles()},a.seedRoads=function(){var e=Math.floor(.25*a.size+Math.random()*(.25*a.size)),t=Math.floor(.25*a.size+Math.random()*(.25*a.size)),n=Math.floor(e+a.size/7+Math.random()*(.5*a.size)),r=Math.floor(t+a.size/7+Math.random()*(.5*a.size));console.log(e+","+t),console.log(n+","+r),a.centerX=t,a.centerY=e;for(var o=0;o<a.size;o++)for(var i=0;i<a.size;i++)if(o===t||i===e||o===r||i===n){var s={type:"road",x:o,y:i},l=a.getTile(o,i,!1);l?l.type="road":a.setTile(o,i,s)}a.getTile(t,e,!1).type="busyroad",a.getCloseNeighbors(t,e,!1).forEach(function(e){e&&(e.type="busyroad")})},a.getCloseNeighbors=function(e,t,n){return[a.getTile(e-1,t,n),a.getTile(e,t-1,n),a.getTile(e+1,t,n),a.getTile(e,t+1,n)]},a.getNeighbors=function(e,t,n){return[a.getTile(e-1,t,n),a.getTile(e-1,t-1,n),a.getTile(e,t-1,n),a.getTile(e+1,t-1,n),a.getTile(e+1,t,n),a.getTile(e+1,t+1,n),a.getTile(e,t+1,n),a.getTile(e-1,t+1,n)]},a.getTypes=function(e){var t={busyroad:0,road:0,house:0,apartment:0,shoppingcenter:0,smallbusiness:0,downtown:0,empty:0,any:0};return e.forEach(function(e){e?(t[e.type]=t[e.type]||0,t[e.type]++,"empty"!=e.type&&"water"!=e.type&&"nature"!=e.type&&t.any++):t.empty++}),t},a.updateTiles=function(){var e=!0,t=!1,n=void 0;try{for(var r,o=a.allTiles[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value,s=a.getNeighbors(i.x,i.y,"empty"!=i.type),l=a.getTypes(s),c=i.type;switch(i.type){case"nature":l.any>=1&&Math.random()<.1&&(i.type="empty");case"empty":l.busyroad>2&&Math.random()<.025&&(i.type="downtown"),1==l.road&&(s[0]&&"road"==s[0].type||s[2]&&"road"==s[2].type||s[4]&&"road"==s[4].type||s[6]&&"road"==s[6].type)&&Math.random()<.15&&(i.type="road"),2!=l.road||l.house>=2||Math.random()<.05&&(i.type="house"),l.road+l.busyroad==3&&(Math.random()<.1?i.type="road":Math.random()<(l.house>=2?.05:.1)?i.type="house":Math.random()<.1&&(i.type="smallbusiness")),l.road>5&&(Math.random()<.01?i.type="downtown":Math.random()<.1&&(i.type="apartment")),l.downtown>0&&(l.road>2||l.busyroad>=1?Math.random()<.01&&(i.type="downtown"):Math.random()<.001&&(i.type="downtown"));break;case"smallbusiness":l.busyroad>0?Math.random()<.01&&(i.type="shoppingcenter"):l.smallbusiness||l.apartment?l.smallbusiness>=1&&Math.random()<.05&&(i.type="empty"):Math.random()<.01&&(i.type="empty"),5!=l.road||l.house>0||Math.random()<.1&&(i.type="shoppingcenter");break;case"house":l.house>2?Math.random()<.1&&(i.type="apartment"):l.downtown>0?Math.random()<.1&&(i.type="empty"):l.busyroad>0&&(Math.random()<.1?i.type="empty":Math.random()<.1&&(i.type="apartment"));break;case"busyroad":l.road+l.busyroad==8&&Math.random()<.25&&(i.type="downtown");break;case"road":l.road+l.busyroad==8&&Math.random()<.1&&(i.type="downtown"),l.downtown>=1&&Math.random()<.01&&(i.type="busyroad"),l.busyroad<=2&&(s[0]&&"busyroad"==s[0].type||s[2]&&"busyroad"==s[2].type||s[4]&&"busyroad"==s[4].type||s[6]&&"busyroad"==s[6].type)&&Math.random()<.05&&(i.type="busyroad");break;case"downtown":l.empty>3&&Math.random()<.1&&(i.type="empty")}i.type!=c&&a.drawTile(i,a.ctx)}}catch(y){t=!0,n=y}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}},a.drawAllTiles=function(){a.allTiles.forEach(function(e){return a.drawTile(e,a.ctx)})},a.addNewTiles=function(){a.allTiles=a.allTiles.concat(a.newTiles),a.newTiles=[]},a.runStep=function(){a.updateTiles(),a.addNewTiles(),a.currentSteps<a.generationSteps?(a.currentSteps++,setTimeout(a.runStep,50)):(console.log("done making terrain, starting a DAY!"),a.startRunningDay())},a.moveUnits=function(){a.allUnits.forEach(function(e){var t=1/a.animationsPerCarTile,n=e.nextTile.x,r=e.nextTile.y;n>=e.x+t?e.x+=t:n<=e.x-t?e.x-=t:e.x=n,r>=e.y+t?e.y+=t:r<=e.y-t?e.y-=t:e.y=r})},a.updateUnits=function(){a.allUnits.forEach(function(e){e.nextTile&&(e.x=e.nextTile.x,e.y=e.nextTile.y);var t=e.x,n=e.y,r=t-e.lastTile.x,o=n-e.lastTile.y,i=t+r,s=n+o,l=a.getCloseNeighbors(e.x,e.y,!1),c=l.filter(function(e){return!!e&&"yourbusiness"==e.type});if(c.length>0&&(console.log("customer!"),Math.random()<.35)){var y=a.convertToScreenSpace(e,.5,.5),u=a.convertToScreenSpace(c[0],.5,.5);a.ctx.beginPath(),a.ctx.lineWidth=2,a.ctx.strokeStyle="gold",a.ctx.moveTo(y.x,y.y),a.ctx.lineTo(u.x,u.y),a.ctx.stroke(),a.ctx.closePath(),a.money+=10,console.log("SOLD! $"+a.money)}var d=l.filter(function(e){return e&&("road"==e.type||"busyroad"==e.type)&&e.x==i&&e.y==s}),p=e.lastTile;if(d[0]&&Math.random()<.9)p=d[0];else{var h=l.filter(function(t){return t&&t!=e.lastTile&&("road"==t.type||"busyroad"==t.type)});if(h.length>0)p=h[Math.round(Math.random()*(h.length-1))]}e.nextTile=p,e.lastTile=a.getTile(t,n,!1)})},a.startRunningDay=function(){var e=!1;a.allTiles.forEach(function(e){if("house"==e.type){var t=a.getCloseNeighbors(e.x,e.y,!1),n=a.getTypes(t);n.road+n.busyroad>0&&a.allUnits.push({type:"car",x:e.x,y:e.y,lastTile:e})}}),a.allTiles.forEach(function(t){if(!e&&"shoppingcenter"==t.type&&Math.random()<.1){var n=a.getCloseNeighbors(t.x,t.y,!1),r=a.getTypes(n);r.road+r.busyroad>0&&(e=!0,t.type="yourbusiness",a.centerX=t.x,a.centerY=t.y,a.scale=3)}}),a.runDay()},a.drawUnit=function(e,t){t.fillStyle="magenta";var n=a.tileSize*a.scale,r=(e.x+.5-a.centerX)*n+a.canvasSize/2,o=(e.y+.5-a.centerY)*n+a.canvasSize/2,i="car"==e.type?.3*a.tileSize:.1*a.tileSize;t.fillRect(r,o,i,i)},a.drawAllUnits=function(){a.allUnits.forEach(function(e){return a.drawUnit(e,a.ctx)})},a.animationsPerCarTile=10,a.currentAnimationStep=0,a.convertToScreenSpace=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=a.tileSize*a.scale;return{x:(e.x+t-a.centerX)*r+a.canvasSize/2,y:(e.y+n-a.centerY)*r+a.canvasSize/2}},a.runDay=function(){a.clearMap(),0==a.currentAnimationStep?a.updateUnits():a.moveUnits(),a.currentAnimationStep++,a.currentAnimationStep>a.animationsPerCarTile&&(a.currentAnimationStep=0),setTimeout(a.runDay,10)},a.clearMap=function(){a.ctx.fillStyle="green",a.ctx.fillRect(0,0,a.canvasSize,a.canvasSize),a.drawAllTiles(),a.drawAllUnits()},a.dragging=!1,a.startX=0,a.startY=0,a.state={},a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){e.runDay()}},"STEP"),r.a.createElement("button",{onClick:function(){e.scale*=1.1,e.clearMap()}},"+"),r.a.createElement("button",{onClick:function(){e.scale*=.9,e.clearMap()}},"-")),r.a.createElement("canvas",{onMouseDown:function(t){e.dragging=!0,e.startX=t.screenX,e.startY=t.screenY},onMouseUp:function(t){e.dragging=!1},onMouseMove:function(t){e.dragging&&(e.centerX+=(e.startX-t.screenX)/(e.scale*e.tileSize),e.centerY+=(e.startY-t.screenY)/(e.scale*e.tileSize),e.startX=t.screenX,e.startY=t.screenY,e.clearMap())},width:this.canvasSize.toString(),height:this.canvasSize.toString(),style:{height:this.canvasSize+"px",width:this.canvasSize+"px"},ref:function(t){!e.canvas&&t&&(e.canvas=t,e.ctx=e.canvas.getContext("2d"),e.seedWater(),e.seedNature(),e.seedRoads(),e.addNewTiles(),e.clearMap(),setTimeout(e.runStep,50))}}))}}]),t}(r.a.Component),p=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(d,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(p,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},8:function(e,t,a){e.exports=a(16)}},[[8,1,2]]]);
//# sourceMappingURL=main.5636bd61.chunk.js.map